{% extends './common-frame.html' %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'styles/add-settings.css' %}">
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
{% endblock %}

{% block main %}
<div class="row">
  <div class="col-12">
    <h1 class="text-center">開催場所/開催日時</h1>
  </div>
</div>
<div class="row">
  <div class="col-12">
    <form action="" method="POST">
      {% for field in form %}
        {{ field.as_hidden }}
      {% endfor %}
      {% if location_undefined %}
      <div class="alert alert-danger" role="alert">
        <strong>エラー</strong><span class="pl-2">開催場所が指定されていません</span>
      </div>
      {% endif %}
      <div class="form-group">
        <label>開催場所</label>
        <div id="type" class="border mb-3"></div>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text" id="location-status">状態</span>
          </div>
          <input class="form-control" type="text" name="location-status" aria-describedby="location-status" value="未設定" readonly>
        </div>
      </div>
      <div class="form-group">
        <label>開催日時</label>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text" id="hold-date">日付</span>
          </div>
          <input class="form-control" type="date" name="hold-date" aria-describedby="hold-date" required>
        </div>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="hold-time">時間</span>
            </div>
            <input class="form-control" type="time" name="hold-time" aria-describedby="hold-time" required>
          </div>
      </div>
      <button class="btn btn-primary" type="submit">送信</button>
      {% csrf_token %}
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="{% static 'scripts/jquery.min.js' %}"></script>
<script src="{% static 'scripts/add-settings.js' %}"></script>
<script src="{% static 'scripts/add-settings.jquery.js' %}"></script>
<script type="text/javascript">
  var map = L.map('type').setView([35.710063, 139.8107], 16);
var tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© <a href="http://osm.org/copyright">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
    maxZoom: 19
});
tileLayer.addTo(map);

var marker = L.marker([35.710063, 139.8107], { 'draggable': 'true' }).addTo(map);

var popup = L.popup();
var content = '<div class="text-center"><p>ここで確定しますか？</p><button id="set-latlng" class="btn btn-primary" type="button">確定</button></div>'

marker.on('click', function() {
    popup.setLatLng(marker.getLatLng())
        .setContent(content)
        .openOn(map)
})
</script>
{% endblock %}